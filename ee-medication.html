<link rel="import" href="../polymer/polymer.html">

<!--  Paper -->
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">

<!-- Iron -->
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">

<!-- Third -->
<link rel="import" href="../vaadin-combo-box/vaadin-combo-box.html">

<!-- Elfy -->
<link rel="import" href="../ee-shared-styles/shared-styles.html">
<link rel="import" href="../ee-helper-behavior/ee-helper-behavior.html">
<link rel="import" href="../js-data-behaviors/js-data-record-behavior.html">
<link rel="import" href="../elfy-api/elfy-api.html">

<!--
`ee-medication`
medication add and display

@demo demo/index.html
-->

<dom-module id="ee-medication">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }
      .row {
        padding: 0 12px;
        height: 48px;
        border: 1px solid #eee;
        margin-top: -1px;
      }

      .actions {
        opacity: 0;
      }
      .row:hover > .actions {
        opacity: 1;
      }
    </style>
    <div class="error">[[errorMessage]]</div>

    <template is="dom-if" if="[[!_edit]]">
      <div class="row h-c">
        <span>[[medication.name]]</span>
        <span class="space"></span>
        <div class="actions">
          <paper-icon-button icon="icons:create" on-tap="toEditMode"></paper-icon-button>
        </div>
      </div>
    </template>

    <template is="dom-if" if="[[_edit]]">
      <div class="h">
        <paper-input id="name" label="Name" value="{{medication.name}}"></paper-input>
        <paper-input id="activeIngredient" label="Active Ingredient" value="{{medication.activeIngredient}}"></paper-input>
      </div>
      <div class="h-c">
        <div class="v-c">
          <paper-input label="dosis value" value="{{medication.dosisValue}}" always-float-label></paper-input>
          <span>e.g. | 1 | </span>
        </div>
        <div class="v-c">
          <paper-input label="dosis unit" value="{{medication.dosisUnit}}" always-float-label></paper-input>
          <span> | Tablett | </span>
        </div>
        <div class="v-c">
          <paper-input label="Repetition" value="{{medication.repetitionValue}}" always-float-label></paper-input>
          <span> | 3 | </span>
        </div>
        <div>&nbsp;x&nbsp;</div>
        <div class="v-c">
          <vaadin-combo-box label="Recurring" items=[[repetitionUnits]]
            item-label-path="label"
            item-value-path="value"
            value="{{medication.repetitionUnit}}" allow-custom-value></vaadin-combo-box>
          <span> | per day | </span>
        </div>
      </div>

      <paper-input label="Ingestion Description" value="{{medication.ingestionDescription}}"></paper-input>
      <paper-button on-tap="_save">Save</paper-button>
      <a class="a-button" on-tap="exitEditMode">Cancel</a>
    </template>

  </template>
  <script>
    Polymer({

      is: 'ee-medication',

      recordName: 'medication',

      behaviors: [
        Elfy.EEHelperBehavior,
        Elfy.JSDataRecordBehavior,
      ],

      properties: {

        repetitionUnits: {
          type: Array,
          value() { return [
              {'label': 'hours', 'value': 'hours'},
              {'label': 'day', 'value': 'day'},
              {'label': 'week', 'value': 'week'},
              {'label': 'as needed', 'value': 'flexible'},
              {'label': 'once', 'value': 'once'},
              {'label': 'other', 'value': 'other'},
            ]}
        },

        medication: {
          type: Object,
          value() { return App.Medication.createRecord() },
        },

        careRecipient: {
          type: Object,
          value() { return {} },
          observer: '_careRecipientChanged'
        },

        _edit: {
          type: Boolean,
          value: false,
          computed: '_computeEdit(edit, medication)'
        },

        edit: {
          type: Boolean,
          value: false,
        }
      },

      attached() {
      },

      toEditMode() {
        this.edit = true
      },

      exitEditMode() {
        this.edit = false
      },

      _computeEdit(edit, med) {
        if (edit) return edit
        return med.id ? false : true
      },

      _careRecipientChanged(cr) {
        if (!cr || !cr.id || !this.medication || this.medication.id) return
        this.medication.careRecipient = cr
      }
    });
  </script>
</dom-module>
